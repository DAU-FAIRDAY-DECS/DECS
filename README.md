# DECS
### 디지털화된 오디오를 네트워크로 전송시 에러율 확인 소프트웨어
>**D**etection **E**rror in **C**ommunication **S**ystem
- 소속 : 동아대학교 컴퓨터공학과<br/> 
- 개발기간 : 2024.03 ~ ing<br/> 

### 팀원
| 이름 | 역할 |
|-----------|-----------|
| 정성윤(팀장) | Autoencoder 이상 감지 모델 구성 및 학습 |
| 강태원 | Autoencoder 이상 감지 모델 구성 및 학습 |
| 박유진 | UDP 기반 VoIP 프로토콜 통신 및 시각화 |
| 전민재 | UDP 기반 VoIP 프로토콜 통신 및 시각화 |

# 프로젝트 소개
디지털 오디오 네트워크 전송 에러율 확인 소프트웨어는 네트워크를 통해 전송된 오디오 데이터의 에러율을 감지하고 분석하여, 네트워크 전송의 안정성을 향상시키는 것을 목표.

### 예상 성과
- **에러율 감지 및 분석 기능 제공**
  - 송수신된 오디오를 비교하여 에러율을 신속하게 감지하고 통계적 분석을 제공하여 사전 조치와 예방이 가능해짐.
### 개발 배경 및 필요성
- 네트워크를 통해 전송되는 오디오 데이터의 품질은 다양한 통신 환경에서 정확한 정보 전달을 위해 필수적.
- 그러나 전송 과정에서 발생할 수 있는 노이즈와 패킷 이슈는 오디오 데이터의 왜곡을 초래할 수 있으며, **이는 중요한 정보 손실을 야기할 수 있음**.
- 특히 함정과 같은 특수한 환경에서는 안전 사고로 이어질 수 있음.

# 개발

## 시스템 구조
<img width="520" alt="image" src="https://github.com/user-attachments/assets/e3b4c2e4-6aaf-492c-8ac0-8283c2458a0b">

1. **데이터를 생성**: VoIP 환경의 센더와 리시버에서 각각 정상 데이터와 비정상 데이터를 생성.
2. **데이터 학습**: 앞에서 만들어진 정상 데이터와 수집한 정상 데이터를 오토인코더에 학습.
3. **에러율 출력**: 학습된 오토인코더 모델에 비정상 데이터를 입력 후 재구성 오차, 임계값을 통해 정상, 비정상을 판별하고 에러율을 출력.

## 아날로그 인터컴 디지털화
아날로그 인터컴 시스템을 사용하여 음성 통신을 디지털 형식으로 전환. 아날로그 오디오 신호를 8kHz 샘플링 레이트와 16비트 해상도로 디지털 변환.

## 음성 오디오 디지털화
- **오디오 포맷**: 16비트 사용
- **샘플링 레이트**: 8000Hz
- **채널 수**: 단일 오디오 채널
- **버퍼 크기**: 오디오 프레임 1024개

## VoIP 프로토콜 통신
VoIP 프로토콜을 통해 IP 네트워크 상태에서 패킷으로 전송. 네트워크 전송 과정에서 발생할 수 있는 패킷 손실, 지연, 순서 등의 이슈를 처리.

## 송신자 서버
![image](https://github.com/paul0817/Markdown/assets/100745610/12ba43e3-72cb-4858-bae6-063d2c09684b)
1. PyAudio 초기화 및 오디오 입력 스트림 개방
2. UDP 소켓 생성
3. PCM 데이터를 ADPCM 데이터로 압축
4. 패킷 이슈 시뮬레이션
5. UDP 소켓을 통한 데이터 전송

## 수신자 서버
![image](https://github.com/paul0817/Markdown/assets/100745610/e5728c5d-5071-4503-93b9-65c735a96cc9)
1. PyAudio 초기화 및 오디오 출력 스트림 개방
2. UDP 소켓 생성
3. 수신된 데이터를 ADPCM 데이터로 재조립
4. 패킷 이슈 시뮬레이션
5. ADPCM 데이터를 PCM 데이터로 압축 해제

## ADPCM 압축
ADPCM 코덱을 사용하여 오디오 데이터를 압축. 이는 원본 음성의 품질을 유지하면서 높은 압축 비율을 제공.

## 통신 결과
 - 패킷 이슈 시뮬레이션을 적용하지 않은 통신 웨이브폼으로, 약간의 패킷 지연은 발생하나 로스가 거의 발생하지 않음

![image](https://github.com/paul0817/Markdown/assets/100745610/b8283a04-0ae0-4ffe-b66a-5dc0e8aaa16a)
<br/><br/>
 - 정상과 비정장 데이터의 구별을 극대화하기 위해 패킷 이슈 시뮬레이션을 삽입한 통신 웨이브폼임
   
![image](https://github.com/paul0817/Markdown/assets/100745610/6e74fb40-6240-47a3-908c-f20b494662e6)

## 스펙트로그램
![image](https://github.com/user-attachments/assets/11596ee1-b18b-48df-b0fc-d48dd2f52c6c)


- WAV 파일을 로드하고 그 파일의 멜 스펙트로그램을 생성
- 음성 인터넷 프로토콜 환경에서 패킷 이슈를 인위적으로 발생시킴
- 이런 과정을 반복해 테스트를 위한 정상 및 비정상 음성 샘플 확보

## wav 데이터 수집
<img width="827" alt="image" src="https://github.com/user-attachments/assets/be556923-443a-434b-b3dd-77556b31a797">

- 러닝 데이터는 노이즈가 없는 정상 데이터로 총 13,500개.
- 테스트 데이터는 정상 481개, 비정상 461개로 총 942개.

## Anomaly Detection
기계 학습 모델을 사용하여 통신 중 발생하는 이상 패킷을 실시간으로 감지하고, 감지된 이상 현상을 분석하여 통신 에러율을 계산. 오토인코더(Autoencoder) 기반의 비지도 학습을 사용하여 정상 및 비정상 데이터를 구분.

<img width="788" alt="image" src="https://github.com/user-attachments/assets/4a1d51b6-4a77-44ba-99fc-958ed7bd2cbb">

- **Autoencoder**: 입력 데이터를 압축한 후 복원하는 신경망
  - **Encoder**: Input 데이터를 압축
  - **Decoder**: 압축된 데이터를 복원
  - **Latent Vector**: 압축 과정에서 추출한 의미 있는 데이터
  - 점진적 차원 / 에포크 100 / 배치 사이즈 64
    
- **선정 이유**: 축 과정에서 정상적인 데이터의 특징을 효과적으로 학습하며, 복원 과정에서는 이상치가 포함된 데이터가 높은 오류를 유발하여, 비정상적인 상황을 쉽게 감지할 수 있기 때문임.

## Autoencoder 입출력 데이터 텐서
![image](https://github.com/user-attachments/assets/f17b2610-4618-4fc7-a25e-ff10a1a06aba)
- 여러 프레임을 하나의 벡터로 이어붙여 특징 벡터를 생성.
- **정상 데이터 텐서**: 오토인코더 모델에 학습되는 데이터.
  - 97개의 데이터 개수와 320차원의 특징 벡터로 구성.
- **비정상 데이터 텐서**: 패킷 이슈가 삽입되어 있으며, 특히 96행과 97행에 이슈가 집중.
- 오토인코더를 통해 비정상 데이터를 재구성한 텐서는 정상 데이터 텐서와 비슷한 형태임을 알 수 있음.
  
## 모델 성능 평가
<img width="496" alt="image" src="https://github.com/user-attachments/assets/bbab3938-de19-4c54-9329-d48c5c418aa1">

> 혼동행렬

### 정확도 (Accuracy)
정확도는 모델이 정확하게 예측한 샘플의 비율을 나타내는 지표.

### 정밀도 (Precision)
정밀도는 모델이 양성으로 예측한 샘플 중 실제로 양성인 샘플의 비율을 나타내는 지표.

### 재현률 (Recall)
재현률은 실제 양성인 샘플 중에서 모델이 올바르게 양성으로 예측한 비율을 나타내는 지표.

### F1 Score
F1 Score은 모델의 예측 성능을 종합적으로 평가하는 지표.

|                 | Predicted Positive | Predicted Negative |
|-----------------|--------------------|--------------------|
| Actual Positive | TP = 416           | FN = 198           |
| Actual Negative | FP = 45            | TN = 283           |
- **정확도**: 74%
- **정밀도**: 90%
- **재현율**: 68%
- **F1 Score**: 77%

### 임계값 수정에 따른 F1 Score 변화
<img width="738" alt="image" src="https://github.com/user-attachments/assets/79f4ae64-9b9a-4bf9-812c-26e3ea96fefa">

- 임계값이 0.85일 때, 가장 높은 F1 Score가 나타남.

## 에러율 검출
1. 최대 오차 대비 백분율
   - 재구성 오차를 최대 허용 오차로 나누어 백분율 계산
2. 평균 오차 대비 백분율
   - 재구성 오차를 정상 데이터의 평균 오차로 나누어 백분율 계산
3. 정규화 오차 대비 백분율
   - 재구성 오차를 최소~최대 오차 범위 내에서 정규화하여 백분율 계산
  
최대와 최소를 활용한 방법은 값의 편차가 클 경우 예상치 못한 값이 나올 수 있다는 한계가 있기에, **안정적인 에러율 출력을 보장**할 수 있는 **평균 오차 대비 백분율** 방식을 채택.

### 평균 오차 대비 백분율
- 오차율을 상대적으로 표현하여 원본과의 차이를 명확하게 드러내기 위해 수정

<img width="536" alt="image" src="https://github.com/user-attachments/assets/b5e59a54-d948-4f44-b29e-f434b928f72a">

### 에러율 시각화
<img width="698" alt="image" src="https://github.com/user-attachments/assets/ac136eed-bb3f-4bc3-a2df-4351b092827f">

- **빨간선**: 비정상 데이터, 에러율 범위: 20~50%
- **파란선**: 정상 데이터, 에러율 범위: 0~20%

## 결론
- 오토인코더 모델을 사용해 정상 데이터는 높은 정확도로 재구성하는 데 성공.
- 비정상 데이터의 경우 재구성 오차를 통해 차이를 측정할 수 있음을 확인함.
- 향후, 노이즈 제거 오토인코더를 추가해 네트워크 안정성과 신뢰성을 확보할 계획

## References

1. [음성 오디오를 멜 스펙트로그램으로 매핑하여 생성된 이미지의 유사성을 분석](https://www.mdpi.com/2227-7390/11/3/498)

2. [오디오 신호 처리](https://velog.io/@p2yeong/%EC%98%A4%EB%94%94%EC%98%A4-%EC%B2%98%EB%A6%ACAudio-Processing)

3. [IP 인터컴 시스템](https://www.toa-products.com/international/download/spec/n-8000ex_kr_cb1k.pdf)

4. [딥러닝 음성 처리 파이썬 실습](https://mz-moonzoo.tistory.com/68)

5. [다중 오토인코더를 통한 치매 음성 데이터 이상 신호 감지](https://repository.hanyang.ac.kr/handle/20.500.11754/186520)

6. [오토인코더 이상 탐지 알고리즘의 성능 비교](https://dcoll.ajou.ac.kr/dcollection/srch/srchDetail/000000032583?localeParam=ko)

